{% extends "classy_table_base.html" %}

{% block scripts %}
{{ super() }}
<script>
urlParam = function(name) {
    var results = new RegExp('[\?&]' + name + '=([^#&]*)').exec(window.location.href);
    if (results == null) {
       return null;
    } else {
       return results[1] || 0;
    }
}

showPlaylistAlert = function() {
    var alert = document.getElementById("no-playlist-alert");
    alert.style.display = "block";
    location.href = "#";
    location.href = "#no-playlist-alert";  
}

$('#submit-playlist').on('click', function(event) {
    var token = urlParam('token');
    var active = $('#table-body').find('.active').attr('value');
    if (active == undefined) {
        showPlaylistAlert();
        return;
    }

    var vals = active.split(',');
    var pid = vals[0];
    var uid = vals[1];
    if (vals == undefined || pid == undefined || uid == undefined) {
        showPlaylistAlert();
    } else {
        var redir = 'tracks?token=' + token + "&uid=" + uid + "&pid=" + pid;
        window.location.replace(redir);
    }
});
</script>
{% endblock %}

{% block classy_content %}
<div class="card">
    <p class="heading">select a playlist</p>
    <div id="top-scroll-fade" class="scroller-fade scroller-fade-top"></div>
    <div id="bottom-scroll-fade" class="scroller-fade scroller-fade-bottom"></div>
        <table id="playlists-table" class="scrollable-table table-input classy-table table clear">
            <thead>
                <tr>
                    <th></th>
                    <th><p>name</p></th>
                    <th><p>owner</p></th>
                    <th><p>number of tracks</p></th>
                </tr>
            </thead>
            <tbody id="table-body">
                {% for item in playlists %}
                <tr class="clickable-row" value="{{ item['id'] }},{{ item['owner']['id'] }}">
                    <td>
                    {% if item['images'][0] is defined %}
                        <img src="{{ item['images'][0]['url'] }}">
                    {% endif %}
                    </td>
                    <td>
                        <p>{{ item['name'] }}</p>
                    </td>
                    <td>
                        <p>{{ item['owner']['id'] }}</p>
                    </td>
                    <td>
                        <p>{{ item['tracks']['total'] }}</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    <a id="submit-playlist" type="button" class="btn btn-success btn-lg center submit-button">SUBMIT PLAYLIST</a>
    <div id="no-playlist-alert" class="alert">
        please select a playlist
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    </div>
</div>
{% endblock %}
